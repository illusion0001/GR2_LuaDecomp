sm18_game_start = false
sm18_game_end = false
sm18_game_phase = 0
sm18_game_result = false
sm18_game_time = 0
sm18_taboo_action = false
sm18_fame_max = 0
sm18_fame_now = 0
sm18_fame_damage = false
sm18_fame_ruffian_damage = 1
sm18_fame_armor_damage = 1
sm18_fame_ruffian_first_damage = 1
sm18_area_down_task = nil
sm18_area_over_task = nil
sm18_area_over_flag1 = false
sm18_area_over_flag2 = false
L0_0 = {}
sm18_box_objs = L0_0
L0_0 = {}
sm18_box_task = L0_0
sm18_box_max = 0
sm18_box_num = 0
L0_0 = {}
sm18_box_interval = L0_0
sm18_box_revival = false
sm18_box_revival_caption = false
L0_0 = {}
sm18_ruffian_puppet = L0_0
L0_0 = {}
sm18_ruffian_life = L0_0
L0_0 = {}
sm18_ruffian_ready = L0_0
L0_0 = {}
sm18_ruffian_start = L0_0
L0_0 = {}
sm18_ruffian_route = L0_0
L0_0 = {}
sm18_ruffian_mnavi = L0_0
sm18_ruffian_num = 0
sm18_ruffian_speed_rate = 1
sm18_ruffian_armor_type = "tkg05"
L0_0 = {}
sm18_ruffian_danger_node = L0_0
L0_0 = {}
sm18_ruffian_danger_name = L0_0
L0_0 = {}
sm18_armor_danger_node = L0_0
L0_0 = {}
sm18_armor_danger_name = L0_0
L0_0 = {}
sm18_armor_danger_se = L0_0
L0_0 = {}
sm18_ruffian_update_task = L0_0
L0_0 = {}
sm18_ruffian_move_task = L0_0
L0_0 = {}
sm18_ruffian_angry_task = L0_0
L0_0 = {}
sm18_ruffian_attack_task = L0_0
sm18_ruffian_danger_marker = nil
L0_0 = {}
sm18_ruffian_wave_table = L0_0
sm18_ruffian_wave_now = 1
sm18_ruffian_wave_permit = false
sm18_ruffian_wave_change = false
L0_0 = {}
sm18_ruffian_wave_caption = L0_0
L0_0 = {
  {
    "",
    "sm18_09001",
    "sm18_09002",
    "sm18_09003"
  },
  {
    "",
    "sm18_09004",
    "sm18_09005",
    "sm18_09006"
  },
  {
    "",
    "sm18_09007",
    "sm18_09008",
    "sm18_09009",
    "sm18_09010"
  }
}
sm18_wave_caption = L0_0
L0_0 = {
  "sm18_09011",
  "sm18_09012",
  "sm18_09013",
  "sm18_09014"
}
sm18_last_caption = L0_0
sm18_ruffian_last_caption = false
L0_0 = {
  {num = 20, caption = "sm18_09015"},
  {num = 15, caption = "sm18_09016"},
  {num = 10, caption = "sm18_09017"},
  {num = 7, caption = "sm18_09018"},
  {num = 5, caption = "sm18_09019"},
  {num = 3, caption = "sm18_09020"},
  {num = 1, caption = "sm18_09021"}
}
sm18_last_num_caption = L0_0
sm18_caption_last_num = 0
sm18_caption_last_time = 0
sm18_transceiver_caption = nil
sm18_transceiver_prio = 0
L0_0 = {}
L0_0.thug01 = "m16_936"
L0_0.thug02 = "m17_936"
L0_0.thug03 = "m18_936"
sm18_ruffian_voice = L0_0
L0_0 = {}
L0_0.danger01 = "man01_threat_00"
L0_0.danger02 = "man01_threat_01"
L0_0.damage = "man01_damage_small_f_00"
sm18_ruffian_motion = L0_0
L0_0 = {}
L0_0.damage = "tkg05_damage_small_b_00"
L0_0.down01 = "tkg05_damage_large_f_00"
L0_0.down02 = "tkg05_down_f_00"
L0_0.angry_00 = "tkg05_angry_00"
L0_0.dig_in_01 = "tkg05_dig_in_01"
L0_0.dig_01 = "tkg05_dig_01"
L0_0.dig_out_01 = "tkg05_dig_out_01"
sm18_armor_motion = L0_0
L0_0 = {
  {caption = "sm18_00100", voice = "m02_936"},
  {caption = "sm18_00101", voice = "m02_935"},
  {caption = "sm18_00102", voice = "m02_936"}
}
sm18_danger_caption = L0_0
L0_0 = {
  {caption = "sm18_00103", voice = "m02_935"},
  {caption = "sm18_00104", voice = "m02_936"},
  {caption = "sm18_00105", voice = "m02_935"}
}
sm18_damage_caption = L0_0
L0_0 = {
  {caption = "sm18_09026", voice = nil}
}
sm18_armor_danger_caption1 = L0_0
L0_0 = {
  {caption = "sm18_09027", voice = nil}
}
sm18_armor_danger_caption2 = L0_0
sm18_ruffian_danger_flag = false
sm18_damage_interval = 0
L0_0 = {
  false,
  false,
  false,
  false
}
sm18_fame_flag = L0_0
sm18_armor_attack_flag = false
sm18_armor_vortex_flag1 = false
sm18_armor_vortex_flag2 = false
L0_0 = {
  {caption = "sm18_09028", voice = nil}
}
sm18_armor_vortex_caption = L0_0
sm18_priority_task = nil
sm18_priority_value = 0
sm18_priority_dest_type = nil
SM18_BOX_RESTORATION_RATE = 0.7
SM18_BOX_RESTORATION_STOP_RATE = 0.9
SM18_BOX_RESTORATION_INTERVAL = 300
SM18_RUFFIAN_STUCK_START = 5
SM18_RUFFIAN_STUCK_DISTANCE = 0.01
SM18_RUFFIAN_STUCK_TIME = 60
SM18_RUFFIAN_LIFE = 1
SM18_ARMOR_LIFE = 3
SM18_ARMOR_SPEED_RATE = 1
L0_0 = {
  "CloseAttack",
  "GravityKick",
  "ScratchTornado",
  "JuptShockWave"
}
SM18_TABOO_ACTION = L0_0
function L0_0(A0_1, A1_2, A2_3, A3_4, A4_5, A5_6, A6_7)
  local L7_8, L8_9, L9_10
  if L7_8 ~= 0 then
    L7_8(L8_9)
  end
  sm18_game_start = false
  sm18_game_end = false
  sm18_game_phase = A0_1
  sm18_game_result = false
  sm18_game_time = 0
  sm18_taboo_action = false
  sm18_fame_max = A1_2
  sm18_fame_now = A1_2
  sm18_fame_damage = false
  sm18_fame_ruffian_damage = A2_3
  sm18_fame_armor_damage = A4_5
  sm18_fame_ruffian_first_damage = A5_6
  L7_8()
  sm18_ruffian_num = 0
  sm18_ruffian_speed_rate = A3_4
  sm18_ruffian_mnavi = L7_8
  sm18_ruffian_danger_node = L7_8
  sm18_ruffian_danger_name = L7_8
  sm18_armor_danger_node = L7_8
  sm18_armor_danger_name = L7_8
  sm18_armor_danger_se = L7_8
  sm18_ruffian_update_task = L7_8
  sm18_ruffian_move_task = L7_8
  sm18_ruffian_angry_task = L7_8
  sm18_ruffian_attack_task = L7_8
  sm18_ruffian_wave_table = A6_7
  sm18_ruffian_wave_now = 1
  sm18_ruffian_wave_permit = true
  sm18_ruffian_wave_change = false
  for _FORV_10_ = 1, #L8_9 do
    sm18_ruffian_wave_caption[_FORV_10_] = false
  end
  sm18_transceiver_prio = 0
  sm18_ruffian_last_caption = false
  sm18_caption_last_num = 0
  sm18_caption_last_time = 0
  L7_8(L8_9)
  sm18_box_max = 0
  sm18_box_num = 0
  sm18_box_revival = false
  sm18_box_revival_caption = false
  while true do
    if sm18_InitBoxGroup(L9_10) ~= false then
      table.insert(L8_9, L9_10)
    end
  end
  L9_10(L9_10, L8_9)
  while true do
    if L8_9 ~= nil then
      L9_10[L7_8] = L8_9
      L9_10[L7_8] = ""
    end
  end
  while true do
    if L8_9 ~= nil then
      L9_10[L7_8] = L8_9
      L9_10[L7_8] = ""
    end
  end
  while true do
  end
  if L7_8 ~= nil then
    L7_8(L8_9)
    sm18_transceiver_caption = nil
  end
  sm18_transceiver_prio = 0
end
sm18_InitGame = L0_0
function L0_0(A0_11)
  local L1_12
  L1_12 = sm18_game_phase
  if L1_12 ~= 0 then
    L1_12 = print
    L1_12("sm18_FinalGame.." .. sm18_game_phase)
    L1_12 = 1
    while sm18_FinalBoxGroup("box" .. string.format("%02d", L1_12)) ~= false do
      L1_12 = L1_12 + 1
    end
    sm18_box_objs = {}
    sm18_box_task = {}
    Player:setGrabExceptionalObject({})
    L1_12 = 1
    while sm18_FinalRuffianGroup("ruffian" .. string.format("%02d", L1_12), A0_11) ~= false do
      L1_12 = L1_12 + 1
    end
    sm18_ruffian_puppet = {}
    sm18_ruffian_life = {}
    L1_12 = 1
    while findGameObject2("Node", "locator2_gravity_gem_" .. string.format("%02d", L1_12)) ~= nil do
      if findGameObject2("Gem", "gravity_gem_" .. string.format("%02d", L1_12)) ~= nil then
        findGameObject2("Gem", "gravity_gem_" .. string.format("%02d", L1_12)):setVisible(false)
        findGameObject2("Gem", "gravity_gem_" .. string.format("%02d", L1_12)):try_term()
      end
      L1_12 = L1_12 + 1
    end
    L1_12 = 1
    while findGameObject2("Node", "locator2_special_gem_" .. string.format("%02d", L1_12)) ~= nil do
      if findGameObject2("Gem", "special_gem_" .. string.format("%02d", L1_12)) ~= nil then
        findGameObject2("Gem", "special_gem_" .. string.format("%02d", L1_12)):setVisible(false)
        findGameObject2("Gem", "special_gem_" .. string.format("%02d", L1_12)):try_term()
      end
      L1_12 = L1_12 + 1
    end
    L1_12 = sm18_ResetAreaOver
    L1_12()
    sm18_ruffian_num = 0
    L1_12 = sm18_ruffian_danger_marker
    if L1_12 ~= nil then
      L1_12 = sm18_ruffian_danger_marker
      L1_12 = L1_12.try_term
      L1_12(L1_12)
      sm18_ruffian_danger_marker = nil
    end
    L1_12 = sm18_transceiver_caption
    if L1_12 ~= nil then
      L1_12 = sm18_transceiver_caption
      L1_12 = L1_12.abort
      L1_12(L1_12)
      sm18_transceiver_caption = nil
    end
    sm18_transceiver_prio = 0
    sm18_game_time = 0
    sm18_game_start = false
    sm18_game_end = false
    sm18_game_phase = 0
  end
  L1_12 = Sound
  L1_12 = L1_12.setGlobalVariable
  L1_12(L1_12, "voice_type", "normal")
end
sm18_FinalGame = L0_0
function L0_0()
  local L0_13, L1_14
  L0_13 = sm18_game_phase
  if L0_13 ~= 0 then
    L0_13 = 1
    while true do
      L1_14 = sm18_StartBoxGroup
      L1_14 = L1_14("box" .. string.format("%02d", L0_13))
      if L1_14 ~= false then
        L0_13 = L0_13 + 1
      end
    end
    L0_13 = 1
    while true do
      L1_14 = sm18_StartRuffianGroup
      L1_14 = L1_14("ruffian" .. string.format("%02d", L0_13))
      if L1_14 ~= false then
        L0_13 = L0_13 + 1
      end
    end
    L0_13 = 1
    while true do
      L1_14 = "gravity_gem_"
      L1_14 = L1_14 .. string.format("%02d", L0_13)
      if RAC_createGemAsync(L1_14, GEM_ENERGY, "locator2_" .. L1_14) ~= nil then
        L0_13 = L0_13 + 1
      end
    end
    L0_13 = 1
    while true do
      L1_14 = "special_gem_"
      L1_14 = L1_14 .. string.format("%02d", L0_13)
      if RAC_createGemAsync(L1_14, GEM_SPECIAL, "locator2_" .. L1_14) ~= nil then
        L0_13 = L0_13 + 1
      end
    end
    L0_13 = RAC_createMapMaker
    L1_14 = "danger_maker"
    L0_13 = L0_13(L1_14, "gui_marker_30", Fn_sendEventComSb("sm18_findGameObject2", "Sensor", "cubesensor2_shop_near"), Vector(24, 11, 20))
    sm18_ruffian_danger_marker = L0_13
    L0_13 = start_game_obj
    L0_13()
    sm18_game_time = 0
    sm18_game_start = true
    sm18_game_end = false
  end
end
sm18_StartGame = L0_0
function L0_0()
  local L0_15, L1_16
  L0_15 = sm18_game_start
  if L0_15 then
    L0_15 = sm18_game_end
    L0_15 = not L0_15
  end
  return L0_15
end
sm18_IsPlaying = L0_0
function L0_0()
  local L0_17, L1_18
  L0_17 = sm18_game_result
  return L0_17
end
sm18_GetResult = L0_0
function L0_0()
  local L0_19, L1_20
  L0_19 = sm18_taboo_action
  return L0_19
end
sm18_isTabooAction = L0_0
function L0_0()
  local L0_21, L1_22
  L0_21 = sm18_area_over_flag2
  return L0_21
end
sm18_GetAreaOverFlag = L0_0
function L0_0()
  Fn_sendEventComSb("sm18_ResetPlayerAreaOut1")
  Fn_sendEventComSb("sm18_ResetPlayerAreaOut2")
  Fn_sendEventComSb("sm18_ResetPlayerAreaDown")
  sm18_area_over_flag1 = false
  sm18_area_over_flag2 = false
  if sm18_area_over_task ~= nil then
    sm18_area_over_task:abort()
    sm18_area_over_task = nil
  end
  if sm18_area_down_task ~= nil then
    sm18_area_down_task:abort()
    sm18_area_down_task = nil
  end
end
sm18_ResetAreaOver = L0_0
function L0_0()
  return math.floor(sm18_game_time / 30)
end
sm18_GetGameTime = L0_0
function L0_0()
  local L0_23, L1_24
  L0_23 = sm18_ruffian_wave_now
  return L0_23
end
sm18_GetWave = L0_0
function L0_0()
  local L1_25
  L1_25 = sm18_ruffian_wave_now
  if L1_25 >= #sm18_ruffian_wave_table then
    L1_25 = true
    return L1_25
  end
  L1_25 = false
  return L1_25
end
sm18_IsLastWave = L0_0
function L0_0()
  local L0_26, L1_27
  L0_26 = sm18_ruffian_wave_change
  return L0_26
end
sm18_IsChangeWave = L0_0
function L0_0()
  return math.floor(sm18_fame_now * 100 / sm18_fame_max)
end
sm18_GetFameNow = L0_0
function L0_0()
  local L0_28, L1_29
  L0_28 = sm18_fame_damage
  return L0_28
end
sm18_IsFameDamage = L0_0
function L0_0()
  local L0_30, L1_31
  sm18_fame_damage = false
end
sm18_ResetFameDamage = L0_0
function L0_0()
  local L0_32, L1_33
  L0_32 = sm18_box_num
  return L0_32
end
sm18_GetBoxNow = L0_0
function L0_0()
  local L0_34, L1_35
  L0_34 = sm18_box_max
  return L0_34
end
sm18_GetBoxMax = L0_0
function L0_0(A0_36)
  local L1_37, L2_38, L3_39, L4_40, L5_41
  L1_37 = sm18_IsPlaying
  L1_37 = L1_37()
  if L1_37 then
    L1_37 = 0
    for L5_41, _FORV_6_ in L2_38(L3_39) do
      if sm18_ruffian_puppet[L5_41] ~= nil and sm18_ruffian_puppet[L5_41]:getActive() and sm18_ruffian_update_task[L5_41] ~= nil and sm18_ruffian_update_task[L5_41]:isRunning() and Fn_getRandamNpcType(L5_41) == A0_36 then
        L1_37 = L1_37 + 1
      end
    end
    return L1_37
  end
  L1_37 = 0
  return L1_37
end
sm18_GetRuffianTypeNum = L0_0
function L0_0(A0_42)
  local L1_43
  L1_43 = sm18_IsPlaying
  L1_43 = L1_43()
  if L1_43 then
    if A0_42 ~= nil and A0_42 == true then
      L1_43 = {}
      for _FORV_5_, _FORV_6_ in pairs(sm18_ruffian_puppet) do
        if sm18_ruffian_puppet[_FORV_5_] ~= nil and sm18_ruffian_puppet[_FORV_5_]:getActive() and sm18_ruffian_update_task[_FORV_5_] ~= nil and sm18_ruffian_update_task[_FORV_5_]:isRunning() then
          L1_43[_FORV_5_] = true
        end
      end
      for _FORV_5_, _FORV_6_ in pairs(sm18_ruffian_ready) do
        if sm18_ruffian_ready[_FORV_5_] ~= nil and sm18_ruffian_ready[_FORV_5_]:isRunning() then
          L1_43[_FORV_5_] = true
        end
      end
      for _FORV_6_, _FORV_7_ in pairs(L1_43) do
      end
      return 0 + 1
    else
      L1_43 = sm18_ruffian_num
      return L1_43
    end
  end
  L1_43 = 0
  return L1_43
end
sm18_GetRuffianNum = L0_0
function L0_0()
  local L1_44, L3_45, L5_46
  L1_44 = 0
  for _FORV_4_ = 1, #L5_46 do
    if sm18_ruffian_danger_name[_FORV_4_] ~= "" then
      L1_44 = L1_44 + 1
    end
  end
  return L1_44
end
sm18_GetRuffianAttackPossessNum = L0_0
function L0_0()
  local L1_47, L3_48, L5_49
  L1_47 = 0
  for _FORV_4_ = 1, #L5_49 do
    if sm18_armor_danger_name[_FORV_4_] ~= "" then
      L1_47 = L1_47 + 1
    end
  end
  return L1_47
end
sm18_GetArmorAttackPossessNum = L0_0
function L0_0()
  local L1_50
  L1_50 = sm18_ruffian_danger_name
  L1_50 = #L1_50
  return L1_50
end
sm18_GetRuffianAttackPosMax = L0_0
function L0_0()
  local L1_51
  L1_51 = sm18_armor_danger_name
  L1_51 = #L1_51
  return L1_51
end
sm18_GetArmorAttackPosMax = L0_0
function L0_0()
  local L0_52
  L0_52 = sm18_ruffian_wave_now
  if L0_52 < #sm18_ruffian_wave_table then
    L0_52 = 0
    for _FORV_4_, _FORV_5_ in ipairs(sm18_ruffian_wave_table[sm18_ruffian_wave_now + 1]) do
      if _FORV_5_.type ~= sm18_ruffian_armor_type then
        L0_52 = L0_52 + 1
      end
    end
    return L0_52
  end
  L0_52 = 0
  return L0_52
end
sm18_GetRuffianNextNum = L0_0
function L0_0()
  local L0_53
  L0_53 = sm18_ruffian_wave_now
  if L0_53 < #sm18_ruffian_wave_table then
    L0_53 = 0
    for _FORV_4_, _FORV_5_ in ipairs(sm18_ruffian_wave_table[sm18_ruffian_wave_now + 1]) do
      if _FORV_5_.type == sm18_ruffian_armor_type then
        L0_53 = L0_53 + 1
      end
    end
    return L0_53
  end
  L0_53 = 0
  return L0_53
end
sm18_GetArmorNextNum = L0_0
function L0_0()
  local L0_54, L1_55, L2_56, L3_57, L4_58, L5_59, L6_60
  L0_54 = 0
  for L4_58 = 1, #L2_56 do
    L5_59 = sm18_ruffian_danger_name
    L5_59 = L5_59[L4_58]
    if L5_59 ~= "" then
      L5_59 = sm18_ruffian_attack_task
      L6_60 = sm18_ruffian_danger_name
      L6_60 = L6_60[L4_58]
      L5_59 = L5_59[L6_60]
      if L5_59 ~= nil then
        L0_54 = L0_54 + 1
      end
    end
  end
  for L4_58 = 1, #L2_56 do
    L5_59 = sm18_armor_danger_name
    L5_59 = L5_59[L4_58]
    if L5_59 ~= "" then
      L5_59 = sm18_ruffian_attack_task
      L6_60 = sm18_armor_danger_name
      L6_60 = L6_60[L4_58]
      L5_59 = L5_59[L6_60]
      if L5_59 ~= nil then
        L0_54 = L0_54 + 1
      end
    end
  end
  return L0_54
end
sm18_GetAttackNum = L0_0
function L0_0(A0_61, A1_62)
  local L2_63, L3_64
  L2_63 = {
    L3_64,
    false,
    false,
    false
  }
  L3_64 = false
  sm18_fame_flag = L2_63
  sm18_damage_interval = 0
  L2_63 = Fn_sendEventComSb
  L3_64 = "sm18_ResetShopRange"
  L2_63(L3_64)
  while true do
    L2_63 = sm18_StartGame
    L2_63()
    L2_63 = Fn_sendEventComSb
    L3_64 = "sm18_EnablePlayerSensor"
    L2_63(L3_64, true)
    L2_63 = RAC_gaugeInit
    L3_64 = "sm18_09000"
    L2_63(L3_64, HUD.kCountType_Down, 0.2, 100)
    L2_63 = Fn_userCtrlOn
    L2_63()
    if A0_61 < 3 then
      L2_63 = Fn_missionViewWait
      L3_64 = "sm18_00108"
      L2_63(L3_64)
    else
      L2_63 = RAC_missionNaviCaptionWait
      L3_64 = "sm18_00108"
      L2_63(L3_64, nil, "sm18_09031", nil, nil, 0)
    end
    while true do
      L2_63 = sm18_IsPlaying
      L2_63 = L2_63()
      if L2_63 then
        L2_63 = sm18_pc_out_task
        if L2_63 ~= nil then
          L2_63 = sm18_pc_out_task
          L3_64 = L2_63
          L2_63 = L2_63.isRunning
          L2_63 = L2_63(L3_64)
          if not L2_63 then
            L2_63 = sm18_pc_out_task
            L3_64 = L2_63
            L2_63 = L2_63.abort
            L2_63(L3_64)
            sm18_pc_out_task = nil
          end
        end
        L2_63 = sm18_priority_task
        if L2_63 ~= nil then
          L2_63 = sm18_priority_dest_type
          if L2_63 ~= nil then
            L2_63 = sm18_GetRuffianTypeNum
            L3_64 = sm18_priority_dest_type
            L2_63 = L2_63(L3_64)
            if L2_63 == 0 then
              L2_63 = Fn_captionViewEnd
              L2_63()
              L2_63 = sm18_AbortPriorityTask
              L2_63()
            end
          else
            L2_63 = sm18_priority_task
            L3_64 = L2_63
            L2_63 = L2_63.isRunning
            L2_63 = L2_63(L3_64)
            if not L2_63 then
              L2_63 = sm18_AbortPriorityTask
              L2_63()
            end
          end
        end
        L2_63 = sm18_UpdateGame
        L2_63()
        L2_63 = sm18_IsChangeWave
        L2_63 = L2_63()
        if L2_63 then
          sm18_ruffian_danger_flag = false
        end
        L2_63 = sm18_pc_out_task
        if L2_63 == nil then
          L2_63 = sm18_GetAreaOverFlag
          L2_63 = L2_63()
          if L2_63 then
            L2_63 = sm18_AbortPriorityTask
            L2_63()
            L2_63 = invokeTask
            function L3_64()
              Fn_userCtrlAllOff()
              Player:setStay(true)
              if Fn_sendEventComSb("sm18_IsPlayerAreaDown") then
                sm18_TransceiverCaption(80, {
                  {caption = "sm18_00109", voice = nil}
                })
              else
                sm18_TransceiverCaption(80, {
                  {caption = "sm18_00110", voice = nil}
                })
              end
              Fn_blackout()
              sm18_ResetAreaOver()
              Fn_resetPcPos(A1_62)
              Player:setStay(false)
              Fn_fadein()
              Fn_userCtrlOn()
            end
            L2_63 = L2_63(L3_64)
            sm18_pc_out_task = L2_63
          end
          L2_63 = sm18_armor_vortex_flag1
          if L2_63 == true then
            L2_63 = sm18_armor_vortex_flag2
            if L2_63 == false then
              function L2_63()
                sm18_TransceiverCaption(78, sm18_armor_vortex_caption)
              end
              update_task = L2_63
              L2_63 = sm18_CreatePriorityTask
              L3_64 = 78
              L2_63 = L2_63(L3_64, update_task)
              if L2_63 then
                sm18_armor_vortex_flag2 = true
              end
            end
          end
          L2_63 = Fn_sendEventComSb
          L3_64 = "sm18_GetShopNearRange"
          L2_63 = L2_63(L3_64)
          L3_64 = Fn_getRandamNpcType
          L3_64 = L3_64(L2_63)
          if L3_64 == sm18_ruffian_armor_type and L2_63 ~= "ruffian02_0101" then
            function L3_64()
              sm18_TransceiverCaption(75, sm18_armor_danger_caption2)
            end
            update_task = L3_64
            L3_64 = sm18_CreatePriorityTask
            L3_64(75, update_task, nil, sm18_ruffian_armor_type)
          end
          L3_64 = Fn_sendEventComSb
          L3_64 = L3_64("sm18_GetShopMiddleRange")
          if Fn_getRandamNpcType(L3_64) == sm18_ruffian_armor_type and L3_64 ~= "ruffian02_0101" then
            function update_task()
              sm18_TransceiverCaption(73, sm18_armor_danger_caption1)
            end
            sm18_CreatePriorityTask(73, update_task, nil, sm18_ruffian_armor_type)
          end
          if Fn_sendEventComSb("sm18_GetShopNearRange") ~= nil and not sm18_ruffian_danger_flag then
            function update_task()
              sm18_TransceiverCaption(40, {
                sm18_danger_caption[math.random(#sm18_danger_caption)]
              })
            end
            if sm18_CreatePriorityTask(40, update_task) then
              sm18_ruffian_danger_flag = true
            end
          end
          if sm18_GetFameNow() > 80 then
          elseif sm18_GetFameNow() > 60 then
            if not sm18_fame_flag[1] then
              function update_task()
                sm18_TransceiverCaption(20, {
                  {caption = "sm18_00111", voice = "m03_934"}
                })
                waitSeconds(SM18_FAME_TASK_INTERVAL)
              end
              function dest_task()
                Fn_sendEventComSb("sm18_ResetShopRange")
              end
              if sm18_CreatePriorityTask(20, update_task, dest_task) then
                sm18_fame_flag[1] = true
              end
            end
          elseif 40 < sm18_GetFameNow() then
            if not sm18_fame_flag[2] then
              function update_task()
                sm18_TransceiverCaption(21, {
                  {caption = "sm18_00112", voice = "m03_934"}
                })
                waitSeconds(SM18_FAME_TASK_INTERVAL)
              end
              function dest_task()
                Fn_sendEventComSb("sm18_ResetShopRange")
              end
              if sm18_CreatePriorityTask(21, update_task, dest_task) then
                sm18_fame_flag[2] = true
              end
            end
          elseif sm18_GetFameNow() > 20 then
            if not sm18_fame_flag[3] then
              function update_task()
                sm18_TransceiverCaption(22, {
                  {caption = "sm18_00113", voice = "m03_934"}
                })
                waitSeconds(SM18_FAME_TASK_INTERVAL)
              end
              function dest_task()
                Fn_sendEventComSb("sm18_ResetShopRange")
              end
              if sm18_CreatePriorityTask(22, update_task, dest_task) then
                sm18_fame_flag[3] = true
              end
            end
          elseif not sm18_fame_flag[4] then
            function update_task()
              sm18_TransceiverCaption(23, {
                {caption = "sm18_00114", voice = "m03_934"}
              })
              waitSeconds(SM18_FAME_TASK_INTERVAL)
            end
            function dest_task()
              Fn_sendEventComSb("sm18_ResetShopRange")
            end
            if sm18_CreatePriorityTask(23, update_task, dest_task) then
              sm18_fame_flag[4] = true
            end
          end
        end
        L2_63 = sm18_IsFameDamage
        L2_63 = L2_63()
        if L2_63 then
          L2_63 = sm18_damage_interval
          L3_64 = SM18_DAMAGE_TASK_INTERVAL
          if L2_63 < L3_64 then
            L2_63 = sm18_damage_interval
            L2_63 = L2_63 + 1
            sm18_damage_interval = L2_63
          else
            L2_63 = sm18_pc_out_task
            if L2_63 == nil then
              function L2_63()
                sm18_TransceiverCaption(10, {
                  sm18_damage_caption[math.random(#sm18_damage_caption)]
                })
                sm18_damage_interval = 0
              end
              update_task = L2_63
              L2_63 = sm18_CreatePriorityTask
              L3_64 = 10
              L2_63 = L2_63(L3_64, update_task)
              if L2_63 then
                L2_63 = sm18_fame_flag
                L2_63[4] = true
              end
            end
          end
        end
        L2_63 = RAC_gaugeSetRate
        L3_64 = sm18_GetFameNow
        L3_64 = L3_64()
        L2_63(L3_64, L3_64())
        L2_63 = sm18_ResetFameDamage
        L2_63()
        L2_63 = Fn_sendEventComSb
        L3_64 = "sm18_ResetShopRange"
        L2_63(L3_64)
        sm18_armor_attack_flag = false
        L2_63 = wait
        L2_63()
      end
    end
    L2_63 = RAC_gaugeSetRate
    L3_64 = sm18_GetFameNow
    L3_64 = L3_64()
    L2_63(L3_64, L3_64())
    L2_63 = sm18_AbortPriorityTask
    L2_63()
    while true do
      L2_63 = sm18_pc_out_task
      if L2_63 ~= nil then
        L2_63 = sm18_pc_out_task
        L3_64 = L2_63
        L2_63 = L2_63.isRunning
        L2_63 = L2_63(L3_64)
        if not L2_63 then
          L2_63 = sm18_pc_out_task
          L3_64 = L2_63
          L2_63 = L2_63.abort
          L2_63(L3_64)
          sm18_pc_out_task = nil
        end
        L2_63 = wait
        L2_63()
      end
    end
    L2_63 = sm18_GetResult
    L2_63 = L2_63()
    if not L2_63 then
      L2_63 = Fn_userCtrlAllOff
      L2_63()
      L2_63 = sm18_armor_attack_flag
      if L2_63 then
        L2_63 = Fn_captionViewWait
        L3_64 = "sm18_09029"
        L2_63(L3_64)
      else
        L2_63 = sm18_TransceiverCaption
        L3_64 = 80
        L2_63(L3_64, {
          {caption = "sm18_00115", voice = "m02_934"}
        })
      end
      L2_63 = Fn_blackout
      L2_63()
      L2_63 = HUD
      L3_64 = L2_63
      L2_63 = L2_63.miniGaugeSetVisible
      L2_63(L3_64, false)
      L2_63 = Fn_sendEventComSb
      L3_64 = "sm18_EnablePlayerSensor"
      L2_63(L3_64, false)
      L2_63 = sm18_FinalGame
      L3_64 = true
      L2_63(L3_64)
      L2_63 = {
        L3_64,
        false,
        false,
        false
      }
      L3_64 = false
      sm18_fame_flag = L2_63
      sm18_damage_interval = 0
      L2_63 = Fn_sendEventComSb
      L3_64 = "sm18_ResetShopRange"
      L2_63(L3_64)
      L2_63 = sm18_InitGame
      L3_64 = A0_61
      L2_63(L3_64, SM18_FAME_MAX, SM18_FAME_DAMAGE, SM18_RUFFIAN_SPEED_RATE, SM18_FAME_ARMOR_DAMAGE, SM18_FAME_FIRST_DAMAGE, SM18_RUFFIAN_WAVE_TABLE)
      L2_63 = sm18_WaitInitBox
      L2_63()
      L2_63 = sm18_WaitInitRuffian
      L2_63()
      L2_63 = Fn_resetPcPos
      L3_64 = A1_62
      L2_63(L3_64)
      L2_63 = Player
      L3_64 = L2_63
      L2_63 = L2_63.setEnergy
      L2_63(L3_64, Player.kEnergy_Gravity, Player:getEnergyMax(Player.kEnergy_Gravity), false)
      L2_63 = Fn_fadein
      L2_63()
      if A0_61 < 3 then
        L2_63 = RAC_infoView
        L3_64 = "sm18_info_02"
        L2_63(L3_64)
      else
        L2_63 = RAC_infoView
        L3_64 = "sm18_info_03"
        L2_63(L3_64)
      end
      sm18_armor_vortex_flag1 = false
      sm18_armor_vortex_flag2 = false
    end
  end
  L2_63 = waitSeconds
  L3_64 = 3
  L2_63(L3_64)
  L2_63 = HUD
  L3_64 = L2_63
  L2_63 = L2_63.miniGaugeSetVisible
  L2_63(L3_64, false)
end
sm18_LoopGame = L0_0
function L0_0()
  local L0_65
  L0_65 = sm18_game_start
  if L0_65 then
    sm18_ruffian_wave_change = false
    L0_65 = sm18_transceiver_caption
    if L0_65 ~= nil then
      L0_65 = sm18_transceiver_caption
      L0_65 = L0_65.isRunning
      L0_65 = L0_65(L0_65)
      if not L0_65 then
        L0_65 = sm18_transceiver_caption
        L0_65 = L0_65.abort
        L0_65(L0_65)
        sm18_transceiver_caption = nil
        sm18_transceiver_prio = 0
      end
    end
    L0_65 = sm18_UpdateBox
    L0_65()
    L0_65 = 1
    while sm18_UpdateRuffianGroup("ruffian" .. string.format("%02d", L0_65)) ~= false do
      L0_65 = L0_65 + 1
    end
    L0_65 = sm18_game_end
    if not L0_65 then
      L0_65 = sm18_GetFameNow
      L0_65 = L0_65()
      if L0_65 <= 0 then
        sm18_game_end = true
        sm18_game_result = false
      else
        L0_65 = sm18_ruffian_wave_now
        if L0_65 >= #sm18_ruffian_wave_table then
          L0_65 = sm18_GetRuffianNum
          L0_65 = L0_65(true)
          if L0_65 == 0 then
            sm18_game_end = true
            sm18_game_result = true
          end
        else
          L0_65 = sm18_ruffian_wave_permit
          if not L0_65 then
            L0_65 = sm18_GetRuffianNum
            L0_65 = L0_65(true)
          elseif L0_65 == 0 then
            L0_65 = sm18_GetRuffianAttackPossessNum
            L0_65 = L0_65()
            L0_65 = L0_65 + sm18_GetRuffianNextNum()
            if L0_65 <= sm18_GetRuffianAttackPosMax() then
              L0_65 = sm18_GetArmorAttackPossessNum
              L0_65 = L0_65()
              L0_65 = L0_65 + sm18_GetArmorNextNum()
              if L0_65 <= sm18_GetArmorAttackPosMax() then
                L0_65 = sm18_ruffian_wave_now
                L0_65 = L0_65 + 1
                sm18_ruffian_wave_now = L0_65
                L0_65 = 1
                while sm18_CreateRuffianGroup("ruffian" .. string.format("%02d", L0_65)) ~= false do
                  L0_65 = L0_65 + 1
                end
                sm18_TransceiverCaption(60, {
                  {caption = "sm18_09022", voice = nil}
                }, false)
                sm18_ruffian_wave_change = true
                sm18_ruffian_wave_permit = false
              end
            end
          end
        end
      end
      L0_65 = sm18_game_end
      if not L0_65 then
        L0_65 = Fn_sendEventComSb
        L0_65 = L0_65("sm18_IsPlayerAreaOut2")
        if L0_65 then
          sm18_area_over_flag2 = true
        else
          L0_65 = Fn_sendEventComSb
          L0_65 = L0_65("sm18_IsPlayerAreaOut1")
          if L0_65 then
            L0_65 = Fn_sendEventComSb
            L0_65 = L0_65("sm18_IsPlayerAreaDown")
            if L0_65 then
              L0_65 = sm18_area_over_task
              if L0_65 ~= nil then
                L0_65 = sm18_area_over_task
                L0_65 = L0_65.abort
                L0_65(L0_65)
                sm18_area_over_task = nil
              end
              L0_65 = sm18_area_down_task
              if L0_65 == nil then
                L0_65 = sm18_area_over_flag2
                if not L0_65 then
                  L0_65 = invokeTask
                  L0_65 = L0_65(function()
                    sm18_TransceiverCaption(80, {
                      {caption = "sm18_09023", voice = nil}
                    })
                  end)
                  sm18_area_down_task = L0_65
                end
              else
                L0_65 = sm18_area_down_task
                if L0_65 ~= nil then
                  L0_65 = sm18_area_down_task
                  L0_65 = L0_65.isRunning
                  L0_65 = L0_65(L0_65)
                  if not L0_65 then
                    sm18_area_over_flag2 = true
                    L0_65 = sm18_area_down_task
                    L0_65 = L0_65.abort
                    L0_65(L0_65)
                    sm18_area_down_task = nil
                  end
                end
              end
            else
              L0_65 = sm18_area_down_task
              if L0_65 ~= nil then
                L0_65 = sm18_area_down_task
                L0_65 = L0_65.abort
                L0_65(L0_65)
                sm18_area_down_task = nil
              end
              L0_65 = sm18_area_over_task
              if L0_65 == nil then
                L0_65 = sm18_area_over_flag1
                if not L0_65 then
                  L0_65 = sm18_area_over_flag2
                  if not L0_65 then
                    L0_65 = invokeTask
                    L0_65 = L0_65(function()
                      sm18_TransceiverCaption(80, {
                        {caption = "sm18_09024", voice = nil}
                      })
                    end)
                    sm18_area_over_task = L0_65
                    sm18_area_over_flag1 = true
                  end
                end
              else
                L0_65 = sm18_area_over_task
                if L0_65 ~= nil then
                  L0_65 = sm18_area_over_task
                  L0_65 = L0_65.isRunning
                  L0_65 = L0_65(L0_65)
                  if not L0_65 then
                    L0_65 = sm18_area_over_task
                    L0_65 = L0_65.abort
                    L0_65(L0_65)
                    sm18_area_over_task = nil
                  end
                end
              end
            end
          else
            sm18_area_over_flag1 = false
            L0_65 = sm18_area_down_task
            if L0_65 ~= nil then
              L0_65 = sm18_area_down_task
              L0_65 = L0_65.abort
              L0_65(L0_65)
              sm18_area_down_task = nil
            end
            L0_65 = sm18_area_over_task
            if L0_65 ~= nil then
              L0_65 = sm18_area_over_task
              L0_65 = L0_65.abort
              L0_65(L0_65)
              sm18_area_over_task = nil
            end
            L0_65 = sm18_ruffian_last_caption
            if L0_65 then
              L0_65 = sm18_GetRuffianNum
              L0_65 = L0_65(true)
              if sm18_GetGameTime() >= sm18_caption_last_time + 10 and L0_65 < sm18_caption_last_num and L0_65 > 0 then
                for _FORV_4_, _FORV_5_ in pairs(sm18_last_num_caption) do
                  if _FORV_5_.num == L0_65 then
                    sm18_TransceiverCaption(30, {
                      {
                        caption = _FORV_5_.caption,
                        voice = nil
                      }
                    }, false)
                    sm18_caption_last_num = L0_65
                    sm18_caption_last_time = sm18_GetGameTime()
                    break
                  end
                end
              end
            end
          end
        end
      end
    end
    L0_65 = sm18_game_time
    L0_65 = L0_65 + 1
    sm18_game_time = L0_65
  end
end
sm18_UpdateGame = L0_0
function L0_0()
  local L0_66, L1_67, L2_68, L3_69, L4_70, L5_71, L6_72
  L0_66 = nil
  sm18_box_num = 0
  L0_66 = 1
  while true do
    L1_67 = sm18_GetBoxGroupNum
    L5_71 = L0_66
    L1_67 = L1_67(L2_68)
    if L1_67 ~= nil then
      sm18_box_num = L2_68
      L0_66 = L0_66 + 1
    end
  end
  L1_67 = sm18_box_num
  L1_67 = L1_67 / L2_68
  if not L2_68 then
    if L1_67 < L2_68 then
      sm18_box_revival = true
      sm18_box_revival_caption = false
    end
  end
  if L2_68 then
    sm18_box_num = 0
    L0_66 = 1
    while true do
      L5_71 = "%02d"
      L6_72 = L0_66
      if L2_68 ~= nil then
        sm18_box_num = L3_69
        L0_66 = L0_66 + 1
      end
    end
    L1_67 = L2_68 / L3_69
    if L1_67 > L2_68 then
      sm18_box_revival = false
    end
  end
  for L5_71, L6_72 in L2_68(L3_69) do
    for _FORV_10_, _FORV_11_ in pairs(L6_72) do
      if _FORV_11_ ~= nil and not _FORV_11_:isRunning() then
        _FORV_11_:abort()
        sm18_box_task[L5_71][_FORV_10_] = nil
      end
    end
  end
end
sm18_UpdateBox = L0_0
function L0_0()
  local L0_73, L1_74
  L0_73 = sm18_game_phase
  if L0_73 ~= 0 then
    L0_73 = 1
    while true do
      L1_74 = "box"
      L1_74 = L1_74 .. string.format("%02d", L0_73)
      if sm18_FinalBoxGroup(L1_74) ~= false then
        L0_73 = L0_73 + 1
      end
    end
    L0_73 = 1
    sm18_box_max = 0
    sm18_box_num = 0
    while true do
      L1_74 = "box"
      L1_74 = L1_74 .. string.format("%02d", L0_73)
      if sm18_InitBoxGroup(L1_74) ~= false then
        L0_73 = L0_73 + 1
      end
    end
    L1_74 = sm18_WaitInitBox
    L1_74()
    L0_73 = 1
    while true do
      L1_74 = "box"
      L1_74 = L1_74 .. string.format("%02d", L0_73)
      if sm18_StartBoxGroup(L1_74) ~= false then
        L0_73 = L0_73 + 1
      end
    end
  end
end
sm18_ResetBox = L0_0
function L0_0(A0_75, A1_76)
  RAC_createGimmickBg(A0_75, "woodbox_kk_01", A1_76, false, true, nil, true):setEventListener("dynamic", function(A0_77)
    A0_77:getDynamicObject():setName("dynamic_obj")
  end)
  RAC_createGimmickBg(A0_75, "woodbox_kk_01", A1_76, false, true, nil, true):pushJob(nil, "N", 0, "D")
  return (RAC_createGimmickBg(A0_75, "woodbox_kk_01", A1_76, false, true, nil, true))
end
sm18_CreateBox = L0_0
function L0_0(A0_78, A1_79)
  if sm18_box_task[A0_78][A1_79] ~= nil then
    sm18_box_task[A0_78][A1_79]:abort()
    sm18_box_task[A0_78][A1_79] = nil
  end
  if sm18_box_objs[A0_78][A1_79] ~= nil then
    if sm18_box_objs[A0_78][A1_79]:isGrabbed() then
      sm18_box_objs[A0_78][A1_79]:setGrabReleaseForce(true)
    end
    if sm18_box_objs[A0_78][A1_79]:getDynamicObject() ~= nil then
      sm18_box_objs[A0_78][A1_79]:getDynamicObject():try_term()
    end
    sm18_box_objs[A0_78][A1_79]:try_term()
    sm18_box_objs[A0_78][A1_79] = nil
  end
end
sm18_ReleaseBox = L0_0
function L0_0(A0_80)
  local L1_81, L2_82, L3_83, L4_84
  L1_81 = Fn_sendEventComSb
  L2_82 = "sm18_findGameObject2"
  L3_83 = "Node"
  L4_84 = "locator2_"
  L4_84 = L4_84 .. A0_80 .. "_center"
  L1_81 = L1_81(L2_82, L3_83, L4_84)
  if L1_81 ~= nil then
    L2_82 = Fn_sendEventComSb
    L3_83 = "sm18_EnableBoxSensor"
    L4_84 = A0_80
    L2_82(L3_83, L4_84, false)
    L2_82 = 1
    L3_83 = sm18_box_objs
    L4_84 = {}
    L3_83[A0_80] = L4_84
    L3_83 = sm18_box_task
    L4_84 = {}
    L3_83[A0_80] = L4_84
    L3_83 = sm18_box_interval
    L4_84 = SM18_BOX_RESTORATION_INTERVAL
    L3_83[A0_80] = L4_84
    while true do
      while true do
        L3_83 = Fn_sendEventComSb
        L4_84 = "sm18_findGameObject2"
        L3_83 = L3_83(L4_84, "Node", "locator2_" .. A0_80 .. "_" .. string.format("%02d", L2_82))
        if L3_83 ~= nil then
          L4_84 = A0_80
          L4_84 = L4_84 .. "_" .. string.format("%02d", L2_82)
          sm18_box_task[A0_80][L4_84] = invokeTask(function()
            print("  create.." .. A0_80)
            sm18_box_objs[A0_80][L4_84] = sm18_CreateBox(A0_80, L3_83)
          end)
          sm18_box_max = sm18_box_max + 1
          sm18_box_num = sm18_box_num + 1
          L2_82 = L2_82 + 1
        end
      end
    end
    L3_83 = true
    return L3_83
  end
  L2_82 = false
  return L2_82
end
sm18_InitBoxGroup = L0_0
function L0_0()
  local L0_85, L1_86, L2_87, L3_88, L4_89, L5_90
  while true do
    for L4_89, L5_90 in L1_86(L2_87) do
      for _FORV_9_, _FORV_10_ in pairs(L5_90) do
        if _FORV_10_ ~= nil then
          if _FORV_10_:isRunning() then
          else
            _FORV_10_:abort()
            sm18_box_task[L4_89][_FORV_9_] = nil
          end
        end
      end
    end
    if L0_85 then
      L1_86()
    end
  end
  for L3_88, L4_89 in L0_85(L1_86) do
    L5_90 = sm18_box_task
    L5_90[L3_88] = {}
  end
end
sm18_WaitInitBox = L0_0
function L0_0(A0_91)
  local L1_92, L2_93, L3_94, L4_95
  L1_92 = Fn_sendEventComSb
  L1_92 = L1_92(L2_93, L3_94, L4_95)
  if L1_92 ~= nil then
    L2_93(L3_94)
    L2_93(L3_94, L4_95, false)
    for _FORV_5_, _FORV_6_ in L2_93(L3_94) do
      if _FORV_6_ ~= nil then
        _FORV_6_:abort()
        sm18_box_task[A0_91][_FORV_5_] = nil
      end
    end
    while true do
      if L3_94 ~= nil then
        if sm18_box_objs[A0_91][L4_95] ~= nil then
          print("  release.." .. sm18_box_objs[A0_91][L4_95]:getName())
          sm18_ReleaseBox(A0_91, L4_95)
        end
      end
    end
    L3_94[A0_91] = 0
    return L3_94
  end
  return L2_93
end
sm18_FinalBoxGroup = L0_0
function L0_0(A0_96)
  if Fn_sendEventComSb("sm18_findGameObject2", "Node", "locator2_" .. A0_96 .. "_center") ~= nil then
    Fn_sendEventComSb("sm18_EnableBoxSensor", A0_96, true)
    return true
  end
  return false
end
sm18_StartBoxGroup = L0_0
function L0_0(A0_97)
  local L1_98, L2_99, L3_100
  L1_98 = Fn_sendEventComSb
  L2_99 = "sm18_findGameObject2"
  L3_100 = "Node"
  L1_98 = L1_98(L2_99, L3_100, "locator2_" .. A0_97 .. "_center")
  if L1_98 ~= nil then
    L2_99 = 0
    L3_100 = findGameObjects
    L3_100 = L3_100("GimmickBg", A0_97)
    if L3_100 ~= nil then
      for _FORV_7_, _FORV_8_ in ipairs(L3_100) do
        if not _FORV_8_:isBroken() then
          L2_99 = L2_99 + 1
        end
      end
    end
    return L2_99
  end
  L2_99 = nil
  return L2_99
end
sm18_GetBoxGroupNum = L0_0
function L0_0(A0_101)
  local L1_102, L2_103, L3_104, L4_105, L5_106, L6_107, L7_108, L8_109
  L1_102 = Fn_sendEventComSb
  L2_103 = "sm18_findGameObject2"
  L3_104 = "Node"
  L4_105 = "locator2_"
  L5_106 = A0_101
  L6_107 = "_center"
  L4_105 = L4_105 .. L5_106 .. L6_107
  L1_102 = L1_102(L2_103, L3_104, L4_105)
  if L1_102 ~= nil then
    L2_103 = sm18_box_interval
    L3_104 = math
    L3_104 = L3_104.max
    L4_105 = sm18_box_interval
    L4_105 = L4_105[A0_101]
    L4_105 = L4_105 - 1
    L5_106 = 0
    L3_104 = L3_104(L4_105, L5_106)
    L2_103[A0_101] = L3_104
    L2_103 = sm18_box_interval
    L2_103 = L2_103[A0_101]
    if L2_103 == 0 then
      L2_103 = Fn_sendEventComSb
      L3_104 = "sm18_IsBoxAreaOut"
      L4_105 = A0_101
      L2_103 = L2_103(L3_104, L4_105)
      if L2_103 then
        L3_104 = Fn_isInSightTarget
        L4_105 = L1_102
        L5_106 = 1
        L3_104 = L3_104(L4_105, L5_106)
        if not L3_104 then
          L3_104 = 0
          L4_105 = 1
          L5_106 = {}
          while true do
            while true do
              L6_107 = Fn_sendEventComSb
              L7_108 = "sm18_findGameObject2"
              L8_109 = "Node"
              L6_107 = L6_107(L7_108, L8_109, "locator2_" .. A0_101 .. "_" .. string.format("%02d", L4_105))
              if L6_107 ~= nil then
                L7_108 = A0_101
                L8_109 = "_"
                L7_108 = L7_108 .. L8_109 .. string.format("%02d", L4_105)
                L8_109 = sm18_box_objs
                L8_109 = L8_109[A0_101]
                L8_109 = L8_109[L7_108]
                if L8_109 ~= nil then
                  if sm18_box_task[A0_101][L7_108] == nil then
                    if not L8_109:isBroken() then
                      L3_104 = L3_104 + 1
                    elseif not Fn_isInSightTarget(L8_109, 1) and not Fn_isInSightTarget(L6_107, 1) then
                      sm18_ReleaseBox(A0_101, L7_108)
                      sm18_box_task[A0_101][L7_108] = invokeTask(function()
                        print("sm18_RelocateBoxGroup.." .. L7_108)
                        sm18_box_objs[A0_101][L7_108] = sm18_CreateBox(A0_101, L6_107)
                        L3_104 = L3_104 + 1
                      end)
                    end
                  else
                    L3_104 = L3_104 + 1
                  end
                end
                L4_105 = L4_105 + 1
              end
            end
          end
          L6_107 = sm18_box_interval
          L7_108 = SM18_BOX_RESTORATION_INTERVAL
          L6_107[A0_101] = L7_108
          L6_107 = sm18_box_revival_caption
          if not L6_107 and L3_104 > 0 then
            L6_107 = sm18_TransceiverCaption
            L7_108 = 50
            L8_109 = {
              {caption = "sm18_09025", voice = nil}
            }
            L6_107(L7_108, L8_109, false)
            sm18_box_revival_caption = true
          end
          return L3_104
        end
      end
    else
    end
    L2_103 = sm18_GetBoxGroupNum
    L3_104 = A0_101
    return L2_103(L3_104)
  end
  L2_103 = nil
  return L2_103
end
sm18_RelocateBoxGroup = L0_0
function L0_0(A0_110)
  local L1_111, L2_112, L3_113, L4_114, L5_115, L6_116, L7_117, L8_118
  L1_111 = findGameObject2
  L2_112 = "Node"
  L3_113 = "locator2_"
  L4_114 = A0_110
  L3_113 = L3_113 .. L4_114 .. L5_115
  L1_111 = L1_111(L2_112, L3_113)
  if L1_111 ~= nil then
    L2_112 = sm18_ruffian_start
    L3_113 = {}
    L2_112[A0_110] = L3_113
    L2_112 = 1
    while true do
      L3_113 = findGameObject2
      L4_114 = "Node"
      L8_118 = string
      L8_118 = L8_118.format
      L8_118 = L8_118("%02d", L2_112)
      L3_113 = L3_113(L4_114, L5_115)
      if L3_113 ~= nil then
        L4_114 = sm18_ruffian_start
        L4_114 = L4_114[A0_110]
        L4_114[L2_112] = L5_115
        L2_112 = L2_112 + 1
      end
    end
    L3_113 = sm18_ruffian_route
    L4_114 = {}
    L3_113[A0_110] = L4_114
    L3_113 = 1
    while true do
      L4_114 = 1
      L8_118 = A0_110
      if L5_115 ~= nil then
        L6_116[L3_113] = L7_117
        while true do
          L8_118 = "locator2_"
          L8_118 = L8_118 .. A0_110 .. "_move" .. string.format("%02d", L3_113) .. "_" .. string.format("%02d", L4_114)
          if L6_116 ~= nil then
            L8_118 = L6_116.getName
            L8_118 = L8_118(L6_116)
            L7_117[L4_114] = L8_118
            L4_114 = L4_114 + 1
          end
        end
        L3_113 = L3_113 + 1
      end
    end
    L4_114 = RAC_getTailNumber
    L4_114 = L4_114(L5_115, L6_116)
    for L8_118, _FORV_9_ in L5_115(L6_116) do
      if L4_114 == _FORV_9_.group then
        print("ruffian" .. string.format("%02d", sm18_ruffian_wave_now) .. string.format("%02d", L8_118) .. " type=" .. _FORV_9_.type .. ", group=" .. _FORV_9_.group .. ", route=" .. _FORV_9_.route .. ", style=" .. _FORV_9_.style)
        if _FORV_9_.type ~= sm18_ruffian_armor_type then
          if spawn_ruffian(A0_110, sm18_ruffian_wave_now, L8_118, _FORV_9_.type, _FORV_9_.route, _FORV_9_.style, _FORV_9_.delay, _FORV_9_.navi, _FORV_9_.last, _FORV_9_.event_no) then
            sm18_ruffian_num = sm18_ruffian_num + 1
          else
            print("\231\148\159\230\136\144\229\164\177\230\149\151.." .. _FORV_9_.type)
          end
        elseif spawn_armor(A0_110, sm18_ruffian_wave_now, L8_118, _FORV_9_.route, _FORV_9_.style, _FORV_9_.delay, _FORV_9_.navi, _FORV_9_.last, _FORV_9_.event_no) then
          sm18_ruffian_num = sm18_ruffian_num + 1
        else
          print("\231\148\159\230\136\144\229\164\177\230\149\151.." .. _FORV_9_.type)
        end
      end
    end
    return L5_115
  end
  L2_112 = false
  return L2_112
end
sm18_InitRuffianGroup = L0_0
function L0_0()
  while true do
    for _FORV_4_, _FORV_5_ in pairs(sm18_ruffian_ready) do
    end
    if true then
      wait()
    end
  end
end
sm18_WaitInitRuffian = L0_0
function L0_0(A0_119, A1_120)
  local L2_121, L3_122, L4_123, L5_124, L6_125, L7_126, L8_127
  L2_121 = findGameObject2
  L6_125 = "_start01"
  L2_121 = L2_121(L3_122, L4_123)
  if L2_121 ~= nil then
    for L6_125, L7_126 in L3_122(L4_123) do
      L8_127 = sm18_ruffian_ready
      L8_127 = L8_127[L6_125]
      if L8_127 ~= nil then
        L8_127 = sm18_ruffian_ready
        L8_127 = L8_127[L6_125]
        L8_127 = L8_127.abort
        L8_127(L8_127)
        L8_127 = sm18_ruffian_ready
        L8_127[L6_125] = nil
      end
    end
    for L6_125, L7_126 in L3_122(L4_123) do
      L8_127 = L6_125
      sm18_AbortRuffianTask(L8_127)
      sm18_ruffian_puppet[L8_127] = nil
      sm18_ruffian_life[L8_127] = 0
      if Fn_findNpc(L8_127) ~= nil then
        if not Fn_findNpc(L8_127):isStarted() then
          if A1_120 then
            while not Fn_findNpc(L8_127):isStarted() do
              wait()
            end
            Fn_disappearNpc(L8_127)
          else
          end
        else
          Fn_disappearNpc(L8_127)
        end
      end
    end
    return L3_122
  end
  return L3_122
end
sm18_FinalRuffianGroup = L0_0
function L0_0(A0_128)
  local L1_129, L2_130, L3_131, L4_132, L5_133, L6_134, L7_135, L8_136
  L1_129 = findGameObject2
  L2_130 = "Node"
  L1_129 = L1_129(L2_130, L3_131)
  if L1_129 ~= nil then
    L2_130 = RAC_getTailNumber
    L2_130 = L2_130(L3_131, L4_132)
    for L6_134, L7_135 in L3_131(L4_132) do
      L8_136 = L7_135.group
      if L2_130 == L8_136 then
        L8_136 = A0_128
        L8_136 = L8_136 .. "_" .. string.format("%02d", sm18_ruffian_wave_now) .. string.format("%02d", L6_134)
        print(L8_136 .. " type=" .. L7_135.type .. ", group=" .. L7_135.group .. ", route=" .. L7_135.route .. ", style=" .. L7_135.style)
        if L7_135.navi and sm18_ruffian_mnavi[L8_136] == nil then
          sm18_RuffianMultiNaviAdd(L8_136, last)
        end
      end
    end
    return L3_131
  end
  L2_130 = false
  return L2_130
end
sm18_StartRuffianGroup = L0_0
function L0_0(A0_137, A1_138, A2_139, A3_140, A4_141, A5_142, A6_143, A7_144, A8_145, A9_146)
  sm18_ruffian_ready[A1_138] = invokeTask(function()
    local L0_147, L1_148, L2_149
    L0_147 = sm18_ruffian_wave_now
    L0_147 = L0_147 == 1
    L1_148 = A6_143
    if L1_148 ~= nil then
      L1_148 = A6_143
      if L1_148 > 0 then
        L1_148 = waitSeconds
        L2_149 = A6_143
        L1_148(L2_149)
      end
    end
    L1_148 = nil
    L2_149 = A9_146
    if L2_149 ~= nil then
      L2_149 = A9_146
      if L2_149 > 0 then
        L2_149 = {
          {
            name = A1_138,
            type = A3_140,
            node = "locator2_" .. A0_137 .. "_event" .. string.format("%02d", A9_146) .. "_pos01",
            attach = false,
            active = true
          }
        }
        L1_148 = L2_149
      end
    else
      L2_149 = sm18_ruffian_start
      L2_149 = L2_149[A0_137]
      L2_149 = L2_149[(A2_139 - 1) % #sm18_ruffian_start[A0_137] + 1]
      L1_148 = {
        {
          name = A1_138,
          type = A3_140,
          node = L2_149,
          attach = false,
          active = true,
          start = not L0_147
        }
      }
    end
    L2_149 = print
    L2_149("sm18_CreateRuffian.." .. A1_138)
    L2_149 = A3_140
    if L2_149 ~= sm18_ruffian_armor_type then
      L2_149 = L1_148[1]
      L2_149.color_variation = RandI(0, 3)
      L2_149 = L1_148[1]
      L2_149.hair_variation = RandI(0, 1)
      L2_149 = print
      L2_149("  color_variation.." .. L1_148[1].color_variation)
      L2_149 = print
      L2_149("  hair_variation.." .. L1_148[1].hair_variation)
    end
    L2_149 = Fn_setupNpc
    L2_149(L1_148)
    L2_149 = sm18_ruffian_puppet
    L2_149[A1_138] = Fn_findNpcPuppet(A1_138)
    L2_149 = Fn_setNpcActive
    L2_149(A1_138, true)
    L2_149 = A3_140
    if L2_149 ~= sm18_ruffian_armor_type then
      L2_149 = Fn_loadNpcEventMotion
      L2_149(A1_138, sm18_ruffian_motion)
    else
      L2_149 = Fn_loadNpcEventMotion
      L2_149(A1_138, sm18_armor_motion)
    end
    L2_149 = Fn_findNpc
    L2_149 = L2_149(A1_138)
    while not L2_149:isStarted() or not L2_149:isReadyNpc() do
      wait()
    end
    if sm18_ruffian_puppet[A1_138] ~= nil then
      L2_149:reset()
      L2_149:enableHomingTarget(true)
      if Fn_getRandamNpcType(A1_138) == sm18_ruffian_armor_type then
        sm18_ruffian_life[A1_138] = SM18_ARMOR_LIFE
        L2_149:changeDamageType(2)
        L2_149:setEventListener("npcDamaged", function(A0_150)
          print("npcDamaged.." .. A1_138 .. "(" .. sm18_ruffian_life[A1_138] .. ")")
          print("  attacker:" .. A0_150.attacker)
          print("  damageType:" .. A0_150.damageType)
          if A0_150.attacker == "player" then
            if sm18_checkTabooAction(A0_150.damageType) then
              sm18_game_end = true
              sm18_game_result = false
              sm18_taboo_action = true
              sm18_fame_now = 0
              sm18_AbortRuffianTask(A1_138)
              if sm18_ruffian_puppet[A1_138] ~= nil and Fn_findNpc(A1_138) ~= nil then
                L2_149:reset()
                Fn_playMotionNpc(A1_138, sm18_armor_motion.damage, false, {isRepeat = false, isStop = true})
              end
            elseif A0_150.damageType == "Vortex" then
              sm18_armor_vortex_flag1 = true
            else
              if A0_150.damageType == "DebriBullet" then
                sm18_ruffian_life[A1_138] = 0
              else
                sm18_ruffian_life[A1_138] = math.max(sm18_ruffian_life[A1_138] - 1, 0)
              end
              if sm18_ruffian_life[A1_138] <= 0 then
                L2_149:enableHomingTarget(false)
                L2_149:changeDamageType(0)
                Sound:setGlobalVariable("voice_type", "normal")
                Sound:setAudibleRange(Sound:playSEHandle("m02_806", 1, "", sm18_ruffian_puppet[A1_138]), 80)
                sm18_RuffianMultiNaviChange(A1_138, A8_145)
                sm18_AbortRuffianTask(A1_138)
                if sm18_ruffian_puppet[A1_138] ~= nil and Fn_findNpc(A1_138) ~= nil then
                  L2_149:setEventListener("npcDamaged", nil)
                  L2_149:reset()
                  Fn_playMotionNpc(A1_138, {
                    sm18_armor_motion.down01,
                    sm18_armor_motion.down02
                  }, false, {
                    isRepeat = false,
                    isStop = true,
                    animBlendDuration = 0.1
                  })
                end
              else
                if sm18_ruffian_angry_task[A1_138] ~= nil then
                  sm18_ruffian_angry_task[A1_138]:abort()
                  sm18_ruffian_angry_task[A1_138] = nil
                end
                if sm18_armor_danger_se[A1_138] ~= nil then
                  Sound:stopSEHandle(sm18_armor_danger_se[A1_138])
                  sm18_armor_danger_se[A1_138] = nil
                end
                if sm18_ruffian_puppet[A1_138] ~= nil and Fn_findNpc(A1_138) ~= nil then
                  L2_149:reset()
                  Fn_playMotionNpc(A1_138, sm18_armor_motion.damage, false, {isRepeat = false, isStop = true})
                end
              end
            end
          end
        end)
      else
        sm18_ruffian_life[A1_138] = SM18_RUFFIAN_LIFE
        L2_149:changeDamageType(2)
        L2_149:setEventListener("npcDamaged", function(A0_151)
          print("npcDamaged.." .. A1_138 .. "(" .. sm18_ruffian_life[A1_138] .. ")")
          print("  attacker:" .. A0_151.attacker)
          print("  damageType:" .. A0_151.damageType)
          if A0_151.attacker == "player" then
            if sm18_checkTabooAction(A0_151.damageType) then
              sm18_game_end = true
              sm18_game_result = false
              sm18_taboo_action = true
              sm18_fame_now = 0
              Sound:setGlobalVariable("voice_type", "normal")
              Sound:setAudibleRange(Sound:playSEHandle(sm18_ruffian_voice[Fn_getRandamNpcType(A1_138)], 1, "", sm18_ruffian_puppet[A1_138]), 80)
              sm18_AbortRuffianTask(A1_138)
              if sm18_ruffian_puppet[A1_138] ~= nil and Fn_findNpc(A1_138) ~= nil then
                L2_149:reset()
                Fn_playMotionNpc(A1_138, "down_st_00", false)
              end
            else
              sm18_ruffian_life[A1_138] = math.max(sm18_ruffian_life[A1_138] - 1, 0)
              if sm18_ruffian_life[A1_138] <= 0 then
                L2_149:enableHomingTarget(false)
                L2_149:changeDamageType(0)
                Sound:setGlobalVariable("voice_type", "normal")
                Sound:setAudibleRange(Sound:playSEHandle(sm18_ruffian_voice[Fn_getRandamNpcType(A1_138)], 1, "", sm18_ruffian_puppet[A1_138]), 80)
                sm18_RuffianMultiNaviChange(A1_138, A8_145)
                sm18_AbortRuffianTask(A1_138)
                if sm18_ruffian_puppet[A1_138] ~= nil and Fn_findNpc(A1_138) ~= nil then
                  L2_149:setEventListener("npcDamaged", nil)
                  L2_149:reset()
                  Fn_playMotionNpc(A1_138, "down_st_00", false)
                end
              elseif sm18_ruffian_puppet[A1_138] ~= nil and Fn_findNpc(A1_138) ~= nil then
                L2_149:reset()
                Fn_playMotionNpc(A1_138, sm18_ruffian_motion.damage, false, {isRepeat = false, isStop = true})
              end
            end
          end
        end)
      end
    end
    while not sm18_game_start do
      wait()
    end
    if sm18_ruffian_puppet[A1_138] ~= nil then
      sm18_CreateRuffianUpdateTask(A0_137, A1_138, A4_141, A5_142, A7_144, A8_145, A9_146, L0_147)
    end
  end)
end
sm18_CreateRuffian = L0_0
function L0_0(A0_152, A1_153, A2_154, A3_155, A4_156, A5_157, A6_158, A7_159)
  if Fn_getRandamNpcType(A1_153) == sm18_ruffian_armor_type then
    sm18_ruffian_update_task[A1_153] = invokeTask(function()
      local L0_160, L1_161, L2_162, L3_163, L4_164, L5_165, L6_166
      L0_160 = sm18_ruffian_move_task
      L1_161 = A1_153
      L0_160[L1_161] = nil
      L0_160 = 10000
      L1_161 = nil
      L2_162 = {}
      if L3_163 == "run" then
        L0_160 = -1
      end
      if L3_163 ~= nil then
      else
        if not (L3_163 > 0) then
      end
      else
        if L3_163 then
          for L6_166 = 1, #L4_164 do
            if sm18_armor_danger_name[L6_166] == A1_153 then
              table.insert(L2_162, sm18_armor_danger_node[L6_166]:getName())
              sm18_ruffian_move_task[A1_153] = RAC_invokeMoveCharaTask2(A1_153, L2_162, {
                runLength = L0_160,
                arrivedLength = 1,
                anim_speed_over = true,
                anim_walk_speed = SM18_ARMOR_SPEED_RATE,
                anim_run_speed = SM18_ARMOR_SPEED_RATE,
                no_stay = true
              })
              L1_161 = sm18_armor_danger_node[L6_166]
              Sound:setGlobalVariable("voice_type", "normal")
              sm18_armor_danger_se[A1_153] = Sound:playSEHandle("npc_suit_foot", 1, nil, sm18_ruffian_puppet[A1_153])
              break
            end
          end
      end
      else
        if L3_163 == 0 then
        end
        for _FORV_7_ = 1, #L5_165 do
          table.insert(L2_162, sm18_ruffian_route[A0_152][L3_163][_FORV_7_])
        end
        for _FORV_7_ = 1, #L5_165 do
          if sm18_armor_danger_name[_FORV_7_] == A1_153 then
            table.insert(L2_162, sm18_armor_danger_node[_FORV_7_]:getName())
            L1_161 = sm18_armor_danger_node[_FORV_7_]
            break
          end
        end
        L4_164[L5_165] = L6_166
        L4_164(L5_165, L6_166, "normal")
        L4_164[L5_165] = L6_166
      end
      L3_163(L4_164, L5_165)
      while true do
        while sm18_ruffian_move_task[A1_153] ~= nil and sm18_ruffian_move_task[A1_153]:isRunning() do
          if L4_164 == false and Fn_sendEventComSb("sm18_ShopNearEnter", A1_153) == true then
            break
          end
          wait()
        end
        if sm18_ruffian_move_task[A1_153] ~= nil then
          sm18_ruffian_move_task[A1_153]:abort()
          sm18_ruffian_move_task[A1_153] = nil
          if sm18_armor_danger_se[A1_153] ~= nil then
            Sound:stopSEHandle(sm18_armor_danger_se[A1_153])
            sm18_armor_danger_se[A1_153] = nil
          end
        end
        if L4_164 == false and L3_163 == true then
          Fn_playMotionNpc(A1_153, "stay", false, {animBlendDuration = 0.4})
          wait()
          sm18_ruffian_angry_task[A1_153] = invokeTask(function()
            if math.random(100) <= 50 then
              Fn_playMotionNpc(A1_153, sm18_armor_motion.angry_00, true)
            else
              Fn_playMotionNpc(A1_153, sm18_armor_motion.dig_in_01, true, {isRepeat = false, isStop = true})
              Sound:setGlobalVariable("voice_type", "normal")
              sm18_armor_danger_se[A1_153] = Sound:playSEHandle("npc_drill_digging", 1, nil, sm18_ruffian_puppet[A1_153])
              Fn_playMotionNpc(A1_153, sm18_armor_motion.dig_01, true, {isRepeat = false, isStop = true})
              if sm18_armor_danger_se[A1_153] ~= nil then
                Sound:stopSEHandle(sm18_armor_danger_se[A1_153])
                sm18_armor_danger_se[A1_153] = nil
              end
              Fn_playMotionNpc(A1_153, sm18_armor_motion.dig_out_01, true, {isRepeat = false, isStop = true})
            end
          end)
          while sm18_ruffian_angry_task[A1_153] ~= nil and sm18_ruffian_angry_task[A1_153]:isRunning() do
            wait()
          end
          Fn_playMotionNpc(A1_153, "stay", false, {animBlendDuration = 0.4})
          if sm18_armor_danger_se[A1_153] ~= nil then
            Sound:stopSEHandle(sm18_armor_danger_se[A1_153])
            sm18_armor_danger_se[A1_153] = nil
          end
        end
        if not (Fn_get_distance(sm18_ruffian_puppet[A1_153]:getWorldPos(), L1_161:getWorldPos()) < 2) then
          waitSeconds(2)
          sm18_ruffian_move_task[A1_153] = RAC_invokeMoveCharaTask2(A1_153, L2_162, {
            runLength = L0_160,
            arrivedLength = 1,
            anim_speed_over = true,
            anim_walk_speed = SM18_ARMOR_SPEED_RATE,
            anim_run_speed = SM18_ARMOR_SPEED_RATE,
            no_stay = true
          }, {startIndex = L6_166})
          Sound:setGlobalVariable("voice_type", "normal")
          sm18_armor_danger_se[A1_153] = Sound:playSEHandle("npc_suit_foot", 1, nil, sm18_ruffian_puppet[A1_153])
        end
      end
      L5_165(L6_166, "stay", false, {animBlendDuration = 0.4})
      L5_165()
      L6_166(A1_153, L5_165)
      L6_166[A1_153] = invokeTask(function()
        while sm18_ruffian_puppet[A1_153] ~= nil do
          Fn_playMotionNpc(A1_153, sm18_armor_motion.dig_in_01, true, {isRepeat = false, isStop = true})
          if false == false and sm18_transceiver_prio < 80 then
            sm18_TransceiverCaption(80, {
              {caption = "sm18_09030", voice = "m02_934"}
            }, false)
          end
          Sound:setGlobalVariable("voice_type", "normal")
          sm18_armor_danger_se[A1_153] = Sound:playSEHandle("npc_drill_digging", 1, nil, sm18_ruffian_puppet[A1_153])
          Fn_playMotionNpc(A1_153, sm18_armor_motion.dig_01, true, {isRepeat = false, isStop = true})
          if sm18_armor_danger_se[A1_153] ~= nil then
            Sound:stopSEHandle(sm18_armor_danger_se[A1_153])
            sm18_armor_danger_se[A1_153] = nil
          end
          Fn_playMotionNpc(A1_153, sm18_armor_motion.dig_out_01, true, {isRepeat = false, isStop = true})
        end
      end)
      while true do
        if L6_166 ~= nil then
          if L6_166 ~= nil then
            if L6_166 ~= nil then
            end
          end
        end
        if L6_166 ~= nil then
          if L6_166 ~= nil then
            sm18_armor_attack_flag = true
            sm18_fame_now = L6_166
            sm18_fame_damage = true
          end
          L6_166()
        end
      end
    end)
  else
    sm18_ruffian_update_task[A1_153] = invokeTask(function()
      local L0_167, L1_168, L2_169, L3_170, L4_171, L5_172, L6_173
      L0_167 = sm18_ruffian_move_task
      L1_168 = A1_153
      L0_167[L1_168] = nil
      L0_167 = 10000
      L1_168 = nil
      if L2_169 == "run" then
        L0_167 = -1
      end
      if L2_169 ~= nil then
      else
        if not (L2_169 > 0) then
      end
      else
        if L2_169 then
          for L5_172 = 1, #L3_170 do
            if L6_173 == A1_153 then
              L6_173[A1_153] = RAC_invokeMoveCharaTask2(A1_153, {
                sm18_ruffian_danger_node[L5_172]:getName()
              }, {
                runLength = L0_167,
                arrivedLength = 1,
                anim_speed_over = true,
                anim_walk_speed = sm18_ruffian_speed_rate,
                anim_run_speed = sm18_ruffian_speed_rate,
                no_stay = true
              })
              L1_168 = L6_173[L5_172]
              break
            end
          end
      end
      else
        if L3_170 == 0 then
        end
        for _FORV_7_ = 1, #L5_172 do
          L2_169[_FORV_7_] = sm18_ruffian_route[A0_152][L3_170][_FORV_7_]
        end
        for _FORV_7_ = 1, #L5_172 do
          if sm18_ruffian_danger_name[_FORV_7_] == A1_153 then
            L2_169[#L2_169] = sm18_ruffian_danger_node[_FORV_7_]:getName()
            L1_168 = sm18_ruffian_danger_node[_FORV_7_]
            break
          end
        end
        L4_171[L5_172] = L6_173
      end
      while true do
        while true do
          if L6_173 ~= nil then
          end
          if L6_173 then
            if L6_173 ~= nil then
              if L6_173 == true then
                if L6_173 == nil then
                  if L6_173 then
                    L6_173(A1_153, A5_157)
                  end
                end
              end
            end
            if L6_173 == nil then
              if L6_173 > SM18_RUFFIAN_STUCK_START then
                if L6_173 < SM18_RUFFIAN_STUCK_DISTANCE then
                  if L5_172 > SM18_RUFFIAN_STUCK_TIME and sm18_ruffian_mnavi[A1_153] == nil then
                    sm18_RuffianMultiNaviAdd(A1_153, A5_157)
                  end
                else
                end
              end
            end
            L6_173()
          end
        end
        if L6_173 ~= nil then
          L6_173(L6_173)
          L6_173[A1_153] = nil
        end
        if not (L6_173 < 1) then
          L6_173(2)
          L6_173[A1_153] = RAC_invokeMoveCharaTask2(A1_153, {
            L1_168:getName()
          }, {
            runLength = L0_167,
            arrivedLength = 1,
            anim_speed_over = true,
            anim_walk_speed = sm18_ruffian_speed_rate,
            anim_run_speed = sm18_ruffian_speed_rate,
            no_stay = true
          })
        end
      end
      L5_172(L6_173, "stay", false, {animBlendDuration = 0.4})
      L5_172()
      if L5_172 == nil then
        if L5_172 ~= nil then
          L5_172(L6_173, A5_157)
        end
      end
      sm18_fame_now = L5_172
      if Fn_get_distance(sm18_ruffian_puppet[A1_153]:getWorldPos(), L5_172:getWorldPos()) < Fn_get_distance(sm18_ruffian_puppet[A1_153]:getWorldPos(), L6_173:getWorldPos()) then
        Fn_turnNpc(A1_153, L5_172)
      else
        Fn_turnNpc(A1_153, L6_173)
      end
      sm18_ruffian_attack_task[A1_153] = invokeTask(function()
        while sm18_ruffian_puppet[A1_153] ~= nil do
          Sound:setGlobalVariable("voice_type", "normal")
          Sound:playSE("m02_502", 1, "", sm18_ruffian_puppet[A1_153])
          Fn_playMotionNpc(A1_153, sm18_ruffian_motion.danger01, true, {
            isRepeat = false,
            isStop = true,
            animBlendDuration = 0.1
          })
          Sound:setGlobalVariable("voice_type", "normal")
          Sound:playSE("m02_502", 1, "", sm18_ruffian_puppet[A1_153])
          Fn_playMotionNpc(A1_153, sm18_ruffian_motion.danger02, true, {
            isRepeat = false,
            isStop = true,
            animBlendDuration = 0.1
          })
        end
      end)
      while sm18_ruffian_puppet[A1_153] ~= nil and sm18_ruffian_attack_task[A1_153] ~= nil and sm18_ruffian_puppet[A1_153] ~= nil and Fn_findNpc(A1_153) ~= nil do
        sm18_fame_now = math.max(sm18_fame_now - sm18_fame_ruffian_damage / 30, 0)
        sm18_fame_damage = true
        wait()
      end
    end)
  end
end
sm18_CreateRuffianUpdateTask = L0_0
function L0_0(A0_174)
  local L1_175, L2_176, L3_177, L4_178, L5_179, L6_180
  L1_175 = findGameObject2
  L2_176 = "Node"
  L1_175 = L1_175(L2_176, L3_177)
  if L1_175 ~= nil then
    L2_176 = RAC_getTailNumber
    L2_176 = L2_176(L3_177, L4_178)
    L3_177(L4_178)
    L3_177(L4_178)
    L3_177(L4_178)
    for L6_180, _FORV_7_ in L3_177(L4_178) do
      if L2_176 == _FORV_7_.group then
        print(A0_174 .. "_" .. string.format("%02d", sm18_ruffian_wave_now) .. string.format("%02d", L6_180) .. " type=" .. _FORV_7_.type .. ", group=" .. _FORV_7_.group .. ", route=" .. _FORV_7_.route .. ", style=" .. _FORV_7_.style)
        if _FORV_7_.type ~= sm18_ruffian_armor_type then
          if spawn_ruffian(A0_174, sm18_ruffian_wave_now, L6_180, _FORV_7_.type, _FORV_7_.route, _FORV_7_.style, _FORV_7_.delay, _FORV_7_.navi, _FORV_7_.last, _FORV_7_.event_no) then
            sm18_ruffian_num = sm18_ruffian_num + 1
          else
            print("\231\148\159\230\136\144\229\164\177\230\149\151.." .. _FORV_7_.type)
          end
        elseif spawn_armor(A0_174, sm18_ruffian_wave_now, L6_180, _FORV_7_.route, _FORV_7_.style, _FORV_7_.delay, _FORV_7_.navi, _FORV_7_.last, _FORV_7_.event_no) then
          sm18_ruffian_num = sm18_ruffian_num + 1
        else
          print("\231\148\159\230\136\144\229\164\177\230\149\151.." .. _FORV_7_.type)
        end
      end
    end
    L3_177(L4_178)
    return L3_177
  end
  L2_176 = false
  return L2_176
end
sm18_CreateRuffianGroup = L0_0
function L0_0(A0_181, A1_182, A2_183, A3_184, A4_185, A5_186, A6_187, A7_188, A8_189, A9_190)
  local L10_191, L11_192
  L10_191 = A0_181
  L11_192 = "_"
  L10_191 = L10_191 .. L11_192 .. string.format("%02d", A1_182) .. string.format("%02d", A2_183)
  L11_192 = 0
  for _FORV_15_ = 1, #sm18_ruffian_danger_node do
    if sm18_ruffian_danger_name[_FORV_15_] == "" then
      L11_192 = _FORV_15_
    end
  end
  if L11_192 == 0 then
    return false
  end
  sm18_ruffian_danger_name[L11_192] = L10_191
  Fn_sendEventComSb("sm18_ResetRuffianNavi", L10_191)
  sm18_CreateRuffian(A0_181, L10_191, A2_183, A3_184, A4_185, A5_186, A6_187, A7_188, A8_189, A9_190)
  return true
end
spawn_ruffian = L0_0
function L0_0(A0_193, A1_194, A2_195, A3_196, A4_197, A5_198, A6_199, A7_200, A8_201)
  local L9_202, L10_203
  L9_202 = A0_193
  L10_203 = "_"
  L9_202 = L9_202 .. L10_203 .. string.format("%02d", A1_194) .. string.format("%02d", A2_195)
  L10_203 = 0
  for _FORV_14_ = 1, #sm18_armor_danger_node do
    if sm18_armor_danger_name[_FORV_14_] == "" then
      L10_203 = _FORV_14_
      break
    end
  end
  if L10_203 == 0 then
    return false
  end
  sm18_armor_danger_name[L10_203] = L9_202
  Fn_sendEventComSb("sm18_ResetRuffianNavi", L9_202)
  sm18_CreateRuffian(A0_193, L9_202, A2_195, sm18_ruffian_armor_type, A3_196, A4_197, A5_198, A6_199, A7_200, A8_201)
  return true
end
spawn_armor = L0_0
function L0_0(A0_204)
  local L1_205, L2_206, L3_207, L4_208, L5_209, L6_210, L7_211
  L1_205 = findGameObject2
  L5_209 = "_start01"
  L1_205 = L1_205(L2_206, L3_207)
  if L1_205 ~= nil then
    for L5_209, L6_210 in L2_206(L3_207) do
      L7_211 = L5_209
      if sm18_ruffian_puppet[L7_211] ~= nil and sm18_ruffian_puppet[L7_211]:getActive() then
        if sm18_ruffian_ready[L7_211] ~= nil then
          if not sm18_ruffian_ready[L7_211]:isRunning() then
            sm18_ruffian_ready[L7_211]:abort()
            sm18_ruffian_ready[L7_211] = nil
          end
        elseif (sm18_ruffian_update_task[L7_211] == nil or not sm18_ruffian_update_task[L7_211]:isRunning()) and Fn_findNpc(L7_211) and Fn_isInSightTarget(sm18_ruffian_puppet[L7_211], 1) == false then
          sm18_DeactiveRuffian(L7_211)
        end
      end
    end
    return L2_206
  end
  return L2_206
end
sm18_UpdateRuffianGroup = L0_0
function L0_0(A0_212)
  if Fn_findNpc(A0_212) ~= nil then
    Fn_findNpc(A0_212):setEventListener("npcDamaged", nil)
    sm18_AbortRuffianTask(A0_212)
    Fn_setNpcActive(A0_212, false)
    sm18_ruffian_puppet[A0_212] = nil
    Fn_sendEventComSb("sm18_ResetRuffianNavi", A0_212)
    sm18_ruffian_num = math.max(sm18_ruffian_num - 1, 0)
    if sm18_game_start and Fn_findNpc(A0_212) ~= nil then
      Fn_disappearNpc(A0_212)
    end
  end
end
sm18_DeactiveRuffian = L0_0
function L0_0(A0_213)
  if sm18_ruffian_update_task[A0_213] ~= nil then
    sm18_ruffian_update_task[A0_213]:abort()
    sm18_ruffian_update_task[A0_213] = nil
  end
  if sm18_ruffian_move_task[A0_213] ~= nil then
    sm18_ruffian_move_task[A0_213]:abort()
    sm18_ruffian_move_task[A0_213] = nil
  end
  if sm18_ruffian_angry_task[A0_213] ~= nil then
    sm18_ruffian_angry_task[A0_213]:abort()
    sm18_ruffian_angry_task[A0_213] = nil
  end
  if sm18_ruffian_attack_task[A0_213] ~= nil then
    sm18_ruffian_attack_task[A0_213]:abort()
    sm18_ruffian_attack_task[A0_213] = nil
  end
  for _FORV_4_ = 1, #sm18_ruffian_danger_name do
    if sm18_ruffian_danger_name[_FORV_4_] == A0_213 then
      sm18_ruffian_danger_name[_FORV_4_] = ""
      break
    end
  end
  for _FORV_4_ = 1, #sm18_armor_danger_name do
    if sm18_armor_danger_name[_FORV_4_] == A0_213 then
      sm18_armor_danger_name[_FORV_4_] = ""
      break
    end
  end
  sm18_RuffianMultiNaviDel(A0_213)
  if sm18_armor_danger_se[A0_213] ~= nil then
    Sound:stopSEHandle(sm18_armor_danger_se[A0_213])
    sm18_armor_danger_se[A0_213] = nil
  end
end
sm18_AbortRuffianTask = L0_0
function L0_0(A0_214, A1_215)
  local L2_216, L3_217, L4_218, L5_219, L6_220, L7_221
  L2_216 = RAC_getTailNumber
  L3_217 = A0_214
  L2_216 = L2_216(L3_217, L4_218, L5_219)
  L3_217 = RAC_getTailNumber
  L3_217 = L3_217(L4_218, L5_219, L6_220)
  L4_218(L5_219)
  if L2_216 == L4_218 then
    if not L4_218 then
    elseif L4_218 ~= nil then
      sm18_ruffian_wave_permit = true
    end
  end
  if L4_218 ~= nil then
    L4_218(L5_219)
    while true do
      if L3_217 < L4_218 then
        L3_217 = L3_217 + 1
        for L7_221, _FORV_8_ in L4_218(L5_219) do
          if L2_216 == RAC_getTailNumber(L7_221, 2, 2) and L3_217 == RAC_getTailNumber(L7_221, 2, nil) then
            if sm18_ruffian_puppet[L7_221] ~= nil and sm18_ruffian_update_task[L7_221] ~= nil and sm18_ruffian_update_task[L7_221]:isRunning() then
              if sm18_ruffian_mnavi[L7_221] == nil then
                sm18_RuffianMultiNaviAdd(L7_221, A1_215)
              end
              return
            end
            L3_217 = L3_217 + 1
          end
        end
      end
    end
  end
end
sm18_RuffianMultiNaviChange = L0_0
function L0_0(A0_222, A1_223)
  print("sm18_RuffianMultiNaviAdd.." .. A0_222)
  Fn_sendEventComSb("sm18_SetRuffianNavi", A0_222)
  if sm18_ruffian_mnavi[A0_222] == nil then
    sm18_ruffian_mnavi[A0_222] = RAC_MultiNaviAdd(sm18_ruffian_puppet[A0_222], nil, 0, -1)
  end
  if not sm18_ruffian_last_caption and A1_223 ~= nil and A1_223 == true then
    if sm18_game_phase < 3 then
      sm18_TransceiverCaption(70, {
        {
          caption = sm18_last_caption[sm18_game_phase],
          voice = nil
        }
      }, false)
    else
      sm18_TransceiverCaption(70, {
        {
          caption = sm18_last_caption[sm18_game_phase],
          voice = nil
        },
        {
          caption = sm18_last_caption[sm18_game_phase + 1],
          voice = nil
        }
      }, false)
    end
    sm18_ruffian_last_caption = true
    sm18_ruffian_wave_permit = true
    sm18_caption_last_num = sm18_GetRuffianNum(true)
    sm18_caption_last_time = sm18_GetGameTime()
  elseif sm18_ruffian_wave_caption[RAC_getTailNumber(A0_222, 2, 2)] == false and sm18_wave_caption[sm18_game_phase][RAC_getTailNumber(A0_222, 2, 2)] ~= nil then
    if sm18_wave_caption[sm18_game_phase][RAC_getTailNumber(A0_222, 2, 2)] ~= "" then
      sm18_TransceiverCaption(70, {
        {
          caption = sm18_wave_caption[sm18_game_phase][RAC_getTailNumber(A0_222, 2, 2)],
          voice = nil
        }
      }, false)
    end
    sm18_ruffian_wave_caption[RAC_getTailNumber(A0_222, 2, 2)] = true
    if RAC_getTailNumber(A0_222, 2, 2) == sm18_ruffian_wave_now then
      sm18_ruffian_wave_permit = true
    end
  end
end
sm18_RuffianMultiNaviAdd = L0_0
function L0_0(A0_224)
  if sm18_ruffian_mnavi[A0_224] ~= nil then
    sm18_ruffian_mnavi[A0_224]:setActive(false)
    sm18_ruffian_mnavi[A0_224]:del()
    sm18_ruffian_mnavi[A0_224] = nil
  end
end
sm18_RuffianMultiNaviDel = L0_0
function L0_0(A0_225, A1_226, A2_227, A3_228)
  local L4_229
  L4_229 = sm18_priority_value
  if A0_225 > L4_229 then
    L4_229 = sm18_AbortPriorityTask
    L4_229()
    L4_229 = {}
    L4_229.update = A1_226
    L4_229.destractor = A2_227
    sm18_priority_value = A0_225
    sm18_priority_dest_type = A3_228
    sm18_priority_task = RAC_InvokeTaskWithDestractor(L4_229.update, L4_229.destractor, L4_229)
    return true
  end
  L4_229 = false
  return L4_229
end
sm18_CreatePriorityTask = L0_0
function L0_0()
  if sm18_priority_task ~= nil then
    sm18_priority_dest_type = nil
    sm18_priority_value = 0
    sm18_priority_task:abort()
    sm18_priority_task = nil
  end
end
sm18_AbortPriorityTask = L0_0
function L0_0(A0_230, A1_231, A2_232)
  if A0_230 >= sm18_transceiver_prio then
    if sm18_transceiver_caption ~= nil then
      sm18_transceiver_caption:abort()
      sm18_transceiver_caption = nil
    end
    sm18_transceiver_prio = A0_230
    sm18_transceiver_caption = invokeTask(function()
      local L0_233, L2_234, L3_235
      for _FORV_3_ = 1, #L2_234 do
        if A1_231[_FORV_3_].voice ~= nil then
          Sound:setGlobalVariable("voice_type", "radio")
          Sound:playSE(A1_231[_FORV_3_].voice, 1, "")
        end
        Fn_captionViewWait(A1_231[_FORV_3_].caption)
      end
    end)
    if A2_232 ~= false then
      while sm18_isTransceiverCaption() do
        wait()
      end
    end
  end
end
sm18_TransceiverCaption = L0_0
function L0_0()
  return sm18_transceiver_caption ~= nil and sm18_transceiver_caption:isRunning()
end
sm18_isTransceiverCaption = L0_0
function L0_0(A0_236, A1_237)
  local L2_238, L3_239, L4_240, L5_241
  for L5_241, _FORV_6_ in L2_238(L3_239) do
    if A0_236 == RAC_getTailNumber(L5_241, 2, 2) and A1_237 == RAC_getTailNumber(L5_241, 2, nil) and sm18_ruffian_puppet[L5_241] ~= nil then
      return sm18_ruffian_puppet[L5_241]
    end
  end
  return L2_238
end
sm18_GetRuffianPuppet = L0_0
function L0_0(A0_242)
  for _FORV_4_, _FORV_5_ in ipairs(SM18_TABOO_ACTION) do
    if _FORV_5_ == A0_242 then
      return true
    end
  end
  return false
end
sm18_checkTabooAction = L0_0
